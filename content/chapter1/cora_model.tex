\section{Cora Model} \label{sec:cora}
The \gls{cora} model takes a set of tasks with some rules and constrains in order to generate a schedule that upholds the specifications. These are fed to the model from the csv file via our own translator.


\subsection*{Task}
\subsection*{Scheduler}
\subsection*{Insolation}
The implementation of insolation and battery charge can be seen in \cref{fig:cora_inso} with relevant declarations and functions in \cref{lst:insolation_code}. The model consist of two locations \uppLoc{in\_sun} and \uppLoc{out\_sun} to ensure that the nanosatellite can only recharge when it has a clear line of sight to the sun. The recharging is done on the looping edge on \uppLoc{in\_sun} with the function $increase\_battery()$. To minimize the number of states generate through queries recharging will only happen eight times during an orbit. When half of the orbitTime have passed, the model is forced to take the transition leading to \uppLoc{out\_sun}, due to the invariants on \uppLoc{in\_sun} location and guard on the transition. Afterward the next transition is available when ins clock is greater or equal to orbitTime, in this transition is also were the clocks ins and splitTime is reset.

On line 10 the declaration for $increase\_battery()$ is define, the purpose of this function is to add energy to the battery and make sure we cannot go over the maximum capacity defined on line 2, the if statement check if the potentially added recharge will make the battery\_cap go over its limit (battery\_max) then is just assign battery\_cap to battery\_max, else we add the recharge amount to battery\_cap. lastly we reset the clock splitTime.

\begin{figure}
	\centering
	\begin{tikzpicture}
	%Locations
	\node [init] (l0) [label={
		[align=left]above:
		\textcolor{name}{in\_sun}
	}, label={
		[align=left]left:
		\textcolor{invariant}{splitTime <= orbitTime / 8}
	}] {};
	\node [location] (l1) [right of=l0, xshift=40mm, label={
		[align=left]above:
		\textcolor{name}{out\_sun}
	}, label={
		[align=left]right:
		\textcolor{invariant}{ins <= orbitTime}
	}] {};
	%Edges
	\path[->,black] (l0) edge[bend left=30] node [midway, above][align=left]{
			\textcolor{guard}{ins >= orbitTime / 2}\\
			\textcolor{guard}{\&\& charge\_count == 8}\\
			\textcolor{update}{charge\_count = 0}} (l1);
	\path[->,black] (l1) edge[bend left=30] node [midway, below][align=left]{
			\textcolor{guard}{ins >= orbitTime}\\
			\textcolor{update}{ins := 0,}\\
			\textcolor{update}{splitTime = 0}} (l0);
	\path[->,black] (l0) edge [loop below] node [midway, below left][align=left]{
			\textcolor{guard}{splitTime >= orbitTime/8}\\
			\textcolor{update}{increase\_battery()}} (l0);
	\end{tikzpicture}
	\caption{Template of insolation}
	\label{fig:cora_inso}
\end{figure}

\begin{figure}
	\begin{lstlisting}[language=my_c, caption={Declarations and function}, label=lst:insolation_code]
// global declarations
const int battery_max = 5400;
const int orbitTime = 90;
const int chargeRate = 2;
int battery_cap = 5400;
int charge_count;

// local declarations
clock splitTime, ins;

void increase_battery(){
	if(battery_max <= battery_cap + (chargeRate * orbitTime)/8){
		battery_cap = battery_max;}
	else{
		battery_cap += (chargeRate * orbitTime)/8;}
	splitTime = 0;
}
	\end{lstlisting}
\end{figure}

The way this is modeled have a few limitations, as previous said we only recharge four times during insolation, this can in some case cause the scheduler to not make the best trace, but the reduced amount of spaces greatly improves the length of the schedules we are able to run. Secondly the model always assume we are starting in \uppLoc{in\_sun}, resulting in our schedule only being able to generate schedules for a nanosatellite when it matches our starting point. This could be fixed with adding a third initial location, that has transitions to \uppLoc{in\_sun} and \uppLoc{out\_sun}, given a variables that will determine which location we should goto based on the actual position of the satellite, along with change the time of ins to capture where in the orbit the nanosatellite is. 


\subsection*{Windows}

\begin{figure}
	\centering
	\begin{tikzpicture}
	%Locations
	\node [init] (l0) {C};
	\end{tikzpicture}
	\caption{Template of insolation}
	\label{fig:cora_inso}
\end{figure}